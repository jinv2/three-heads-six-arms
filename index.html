<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å¤´å…­è‡‚åˆ›ä¸–ç³»ç»Ÿ - è¶…çº§ä¸ªä½“è·¨ç•Œèµ‹èƒ½å¹³å°</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(15px);
            padding: 40px;
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        h1 {
            text-align: center;
            font-size: 3.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            opacity: 0.9;
            margin-bottom: 40px;
            font-size: 1.2rem;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 20px;
            border: 2px solid rgba(0,219,222,0.3);
            border-radius: 15px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 16px;
            margin-bottom: 25px;
            resize: vertical;
            transition: all 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #00dbde;
            box-shadow: 0 0 20px rgba(0,219,222,0.2);
        }
        textarea::placeholder {
            color: rgba(255,255,255,0.4);
        }
        .generate-btn {
            background: linear-gradient(90deg, #00dbde, #fc00ff);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            letter-spacing: 1px;
        }
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,219,222,0.3);
        }
        .results {
            margin-top: 50px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .section-title {
            color: #00dbde;
            border-left: 4px solid #fc00ff;
            padding-left: 15px;
            margin: 30px 0 20px;
        }
        .analysis-card {
            background: linear-gradient(145deg, rgba(0,219,222,0.1), rgba(252,0,255,0.05));
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .gene-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 4px solid #00dbde;
            transition: all 0.3s;
        }
        .gene-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateX(5px);
        }
        .gene-tag {
            display: inline-block;
            background: rgba(0,219,222,0.2);
            color: #00dbde;
            padding: 5px 12px;
            border-radius: 20px;
            margin: 5px 5px 5px 0;
            font-size: 0.85rem;
            border: 1px solid rgba(0,219,222,0.3);
        }
        .arm-button {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 25px;
            margin: 8px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: inline-block;
        }
        .arm-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        .commercial-panel {
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,140,0,0.05));
            padding: 30px;
            border-radius: 20px;
            margin-top: 40px;
            border: 1px solid rgba(255,215,0,0.2);
            display: none;
        }
        .pricing-card {
            background: rgba(255,255,255,0.08);
            padding: 25px;
            border-radius: 15px;
            margin: 15px;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .pricing-card:hover {
            transform: translateY(-5px);
            border-color: #00dbde;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }
        .loading-dots:after {
            content: ' .';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ' ...'; }
        }
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
            opacity: 0.7;
        }
        .status-badge {
            display: inline-block;
            background: rgba(0,255,127,0.2);
            color: #00ff7f;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
            border: 1px solid rgba(0,255,127,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¬ ä¸‰å¤´å…­è‡‚åˆ›ä¸–ç³»ç»Ÿ</h1>
        <p class="subtitle">è¶…çº§ä¸ªä½“è·¨ç•Œèµ‹èƒ½å¹³å° Â· åŸºäºå…±ç”Ÿåè®® v2.0 <span class="status-badge">æ™ºèƒ½å¼•æ“å·²ä¸Šçº¿</span></p>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div>
            <textarea id="userInput" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„ä¸“ä¸šèƒ½åŠ›ã€ç»éªŒæˆ–æƒ³è§£å†³çš„é—®é¢˜...
            
ä¾‹å¦‚ï¼š
â€¢ æˆ‘æ˜¯ä¸€åæ‚¬ç–‘å°è¯´ä½œå®¶ï¼Œæ“…é•¿åˆ¶é€ æ‚¬å¿µå’Œåè½¬
â€¢ æˆ‘æ˜¯ç‹¬ç«‹éŸ³ä¹åˆ¶ä½œäººï¼Œç²¾é€šç”µå­éŸ³ä¹ç¼–æ›²
â€¢ æˆ‘ä»äº‹å“ç‰Œè§†è§‰è®¾è®¡ï¼Œéœ€è¦ä¸ºä¼ ç»Ÿè¡Œä¸šåˆ›æ–°
â€¢ æˆ‘æ˜¯æˆå‰§å¯¼æ¼”ï¼Œæƒ³è¦å°†èˆå°ç»éªŒåº”ç”¨äºå•†ä¸šåŸ¹è®­"></textarea>
            <button class="generate-btn" onclick="generateSmartPlan()">
                ğŸš€ ç”Ÿæˆæ™ºèƒ½è·¨ç•Œæ–¹æ¡ˆ
            </button>
        </div>
        
        <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
        <div class="results" id="results">
            <h2 class="section-title">ğŸ¯ æ™ºèƒ½åˆ†ææŠ¥å‘Š</h2>
            
            <!-- æ™ºèƒ½åˆ†æå¡ç‰‡ -->
            <div class="analysis-card" id="analysisSection">
                <h3>ğŸ§  ç³»ç»Ÿç†è§£ä¸åˆ†æ</h3>
                <div id="analysisContent">
                    <p>æ­£åœ¨åˆ†ææ‚¨çš„ä¸“ä¸šèƒŒæ™¯ä¸æ½œåœ¨éœ€æ±‚...</p>
                </div>
            </div>
            
            <!-- æ–¹æ³•åŸºå› å±•ç¤º -->
            <h3 class="section-title">ğŸ”¬ åŒ¹é…çš„æ–¹æ³•åŸºå› </h3>
            <div id="genesSection">
                <p>æ­£åœ¨ä¸ºæ‚¨åŒ¹é…é«˜ç›¸å…³çš„æ–¹æ³•è®ºåŸºå› ...</p>
            </div>
            
            <!-- ä¸‰å¤´å…­è‡‚æ–¹æ¡ˆ -->
            <h3 class="section-title">ğŸ­ ä¸‰å¤´å…­è‡‚èµ‹èƒ½æ–¹æ¡ˆ</h3>
            <div class="analysis-card">
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div>
                        <h4>ğŸ“– æ–‡å­¦å¤´</h4>
                        <p id="literatureHead">æ­£åœ¨æ„å»ºå™äº‹æ¡†æ¶...</p>
                    </div>
                    <div>
                        <h4>ğŸµ éŸ³ä¹å¤´</h4>
                        <p id="musicHead">æ­£åœ¨è®¾è®¡èŠ‚å¥ç»“æ„...</p>
                    </div>
                    <div>
                        <h4>ğŸ¬ å½±è§†å¤´</h4>
                        <p id="filmHead">æ­£åœ¨ç­–åˆ’è§†è§‰è¡¨è¾¾...</p>
                    </div>
                </div>
                
                <div>
                    <h4>ğŸ¦¾ å…­è‡‚æ‰§è¡Œç³»ç»Ÿ</h4>
                    <div id="sixArmsExecution" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div class="arm-button" onclick="armFunction('diagnose')">è¯Šæ–­</div>
                        <div class="arm-button" onclick="armFunction('graft')">å«æ¥</div>
                        <div class="arm-button" onclick="armFunction('architect')">æ¶æ„</div>
                        <div class="arm-button" onclick="armFunction('material')">ç‰©æ–™</div>
                        <div class="arm-button" onclick="armFunction('monetize')">å˜ç°</div>
                        <div class="arm-button" onclick="armFunction('collaborate')">ååŒ</div>
                    </div>
                    <div id="executionDetails" style="margin-top: 20px;">
                        <p>ç‚¹å‡»ä»»ä¸€æ‰§è¡Œè‡‚æŸ¥çœ‹è¯¦ç»†æ–¹æ¡ˆ...</p>
                    </div>
                </div>
            </div>
            
            <!-- å•†ä¸šåŒ–å…¥å£ -->
            <div style="text-align: center; margin: 40px 0;">
                <button class="generate-btn" style="width: auto; padding: 15px 40px;" onclick="showCommercialPanel()">
                    ğŸ’° ç«‹å³è½¬åŒ–ä¸ºå•†ä¸šé¡¹ç›®
                </button>
            </div>
        </div>
        
        <!-- å•†ä¸šåŒ–é¢æ¿ -->
        <div class="commercial-panel" id="commercialPanel">
            <h2 class="section-title">å•†ä¸šè½¬åŒ–ä¸­å¿ƒ</h2>
            
            <!-- å®šä»·æ–¹æ¡ˆ -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px 0;">
                <div class="pricing-card">
                    <h3>ä½“éªŒç‰ˆ</h3>
                    <p style="font-size: 2rem; color: #00dbde;">Â¥299</p>
                    <p>å•æ¬¡æ·±åº¦åˆ†æ</p>
                    <button class="arm-button" onclick="selectPlan('trial')">ç«‹å³ä½“éªŒ</button>
                </div>
                <div class="pricing-card" style="border: 2px solid #00dbde; transform: scale(1.05);">
                    <h3>ä¸“ä¸šç‰ˆ</h3>
                    <p style="font-size: 2.5rem; color: #fc00ff;">Â¥999</p>
                    <p>æœˆåº¦æ— é™ç”Ÿæˆ</p>
                    <button class="arm-button" style="background: linear-gradient(90deg, #00dbde, #fc00ff);" 
                            onclick="selectPlan('pro')">
                        è®¢é˜…ä¸“ä¸šç‰ˆ
                    </button>
                </div>
                <div class="pricing-card">
                    <h3>ä¼ä¸šç‰ˆ</h3>
                    <p style="font-size: 2rem; color: #ffd700;">Â¥9,999</p>
                    <p>å¹´åº¦åˆä¼™äºº</p>
                    <button class="arm-button" onclick="selectPlan('enterprise')">å®šåˆ¶å’¨è¯¢</button>
                </div>
            </div>
            
            <!-- å•†ä¸šå·¥å…· -->
            <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 15px;">
                <h3>å•†ä¸šå·¥å…·ç®±</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin: 20px 0;">
                    <button class="arm-button" onclick="generateQuote()">ğŸ“„ ç”ŸæˆæŠ¥ä»·å•</button>
                    <button class="arm-button" onclick="createProposal()">ğŸ“‹ åˆ›å»ºå®¢æˆ·ææ¡ˆ</button>
                    <button class="arm-button" onclick="showContract()">ğŸ“‘ åˆåŒæ¨¡æ¿</button>
                    <button class="arm-button" onclick="calculateROI()">ğŸ“Š ROIåˆ†æ</button>
                    <button class="arm-button" onclick="paymentOptions()">ğŸ’³ æ”¯ä»˜è®¾ç½®</button>
                </div>
                <div id="commercialOutput" style="margin-top: 20px;"></div>
            </div>
        </div>
        
        <footer>
            <p>Â© 2024 ä¸‰å¤´å…­è‡‚åˆ›ä¸–ç³»ç»Ÿ | æ™ºèƒ½åŸºå› åº“ v2.0 | åè®®é©±åŠ¨ Â· é›†ä½“è¿›åŒ–</p>
            <p style="font-size: 0.8rem; margin-top: 10px;">
                GitHub: jinv2/three-heads-six-arms | 
                <span id="apiStatus" style="color: #00ff7f;">äº‘ç«¯æ™ºèƒ½å¼•æ“ âœ“ åœ¨çº¿</span>
            </p>
        </footer>
    </div>

    <script>
    // ==================== å…¨å±€çŠ¶æ€ä¸é…ç½® ====================
    let currentAnalysis = null;
    let currentGenes = [];
    
    // ==================== æ™ºèƒ½ç†è§£å¼•æ“è°ƒç”¨ ====================
    async function generateSmartPlan() {
        const userInput = document.getElementById('userInput').value.trim();
        if (!userInput) {
            alert('è¯·è¾“å…¥æ‚¨çš„ä¸“ä¸šæè¿°');
            return;
        }
        
        // æ˜¾ç¤ºç»“æœåŒºåŸŸå’ŒåŠ è½½çŠ¶æ€
        document.getElementById('results').style.display = 'block';
        document.getElementById('analysisContent').innerHTML = 
            '<div class="loading"><span class="loading-dots">æ­£åœ¨æ·±åº¦åˆ†ææ‚¨çš„ä¸“ä¸šèƒŒæ™¯</span></div>';
        document.getElementById('genesSection').innerHTML = 
            '<p class="loading"><span class="loading-dots">åŒ¹é…é«˜ç›¸å…³æ–¹æ³•åŸºå› </span></p>';
        document.getElementById('literatureHead').textContent = 'åˆ†æä¸­...';
        document.getElementById('musicHead').textContent = 'åˆ†æä¸­...';
        document.getElementById('filmHead').textContent = 'åˆ†æä¸­...';
        document.getElementById('executionDetails').innerHTML = '<p>ç­‰å¾…åˆ†æç»“æœ...</p>';
        
        // éšè—å•†ä¸šåŒ–é¢æ¿
        document.getElementById('commercialPanel').style.display = 'none';
        
        try {
            console.log('ğŸ“¡ è°ƒç”¨æ™ºèƒ½ç†è§£å¼•æ“...');
            
            // è°ƒç”¨æ–°çš„æ™ºèƒ½ç†è§£å‡½æ•°
            const response = await fetch('/.netlify/functions/understand-and-match', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ userInput })
            });
            
            if (!response.ok) {
                throw new Error(`APIå“åº”é”™è¯¯: ${response.status}`);
            }
            
            const result = await response.json();
            console.log('âœ… æ”¶åˆ°æ™ºèƒ½åˆ†æç»“æœ:', result);
            
            if (!result.success) {
                throw new Error(result.error || 'åˆ†æå¤±è´¥');
            }
            
            // ä¿å­˜å½“å‰åˆ†æç»“æœ
            currentAnalysis = result.analysis;
            currentGenes = result.data;
            
            // æ›´æ–°APIçŠ¶æ€æ˜¾ç¤º
            document.getElementById('apiStatus').innerHTML = 
                `æ™ºèƒ½å¼•æ“ âœ“ å·²å¤„ç† ${result.analysis.intelligence_level} åˆ†æ`;
            
            // æ˜¾ç¤ºæ™ºèƒ½åˆ†æè¿‡ç¨‹
            renderAnalysis(result);
            
            // æ˜¾ç¤ºåŸºå› åŒ¹é…ç»“æœ
            renderGenes(result);
            
            // ç”Ÿæˆä¸‰å¤´å…­è‡‚æ–¹æ¡ˆ
            renderThreeHeadsSixArms(result);
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            document.getElementById('results').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
        } catch (error) {
            console.error('âŒ ç”Ÿæˆå¤±è´¥:', error);
            
            // é™çº§åˆ°æœ¬åœ°é€»è¾‘
            document.getElementById('analysisContent').innerHTML = `
                <div style="color: #ff6b6b;">
                    <h4>âš ï¸ æ™ºèƒ½å¼•æ“æš‚æ—¶ä¸å¯ç”¨</h4>
                    <p>ä½¿ç”¨æœ¬åœ°ä¸“å®¶ç³»ç»Ÿä¸ºæ‚¨ç”Ÿæˆæ–¹æ¡ˆ...</p>
                </div>
            `;
            
            // æœ¬åœ°é™çº§æ–¹æ¡ˆ
            generateLocalFallback(userInput);
            
            // æ›´æ–°çŠ¶æ€
            document.getElementById('apiStatus').innerHTML = 
                'æ™ºèƒ½å¼•æ“ âœ— ç¦»çº¿ | ä½¿ç”¨æœ¬åœ°æ¨¡å¼';
            document.getElementById('apiStatus').style.color = '#ff6b6b';
        }
    }
    
    // ==================== æ¸²æŸ“æ™ºèƒ½åˆ†æ ====================
    function renderAnalysis(result) {
        const analysis = result.analysis;
        
        let analysisHTML = `
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                <div>
                    <h4 style="color: #00dbde;">ğŸ“ è¾“å…¥è§£æ</h4>
                    <p>"${analysis.user_input}"</p>
                </div>
                <div>
                    <h4 style="color: #00dbde;">ğŸ§  æ™ºèƒ½ç­‰çº§</h4>
                    <p>${analysis.intelligence_level} (${analysis.query_method})</p>
                </div>
            </div>
        `;
        
        if (analysis.matched_scenarios.length > 0) {
            analysisHTML += `
                <div style="margin-top: 20px;">
                    <h4 style="color: #fc00ff;">ğŸ¯ è¯†åˆ«çš„é—®é¢˜åœºæ™¯</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        ${analysis.matched_scenarios.map(scenario => 
                            `<span style="background: rgba(252,0,255,0.2); padding: 8px 15px; border-radius: 20px; 
                              border: 1px solid rgba(252,0,255,0.3);">${scenario}</span>`
                        ).join('')}
                    </div>
                </div>
            `;
        }
        
        if (analysis.matched_domains.length > 0) {
            analysisHTML += `
                <div style="margin-top: 20px;">
                    <h4 style="color: #00dbde;">ğŸŒ ç›¸å…³åº”ç”¨é¢†åŸŸ</h4>
                    <p>${analysis.matched_domains.join(' â†’ ')}</p>
                </div>
            `;
        }
        
        if (result.recommendations && result.recommendations.length > 0) {
            analysisHTML += `
                <div style="margin-top: 20px; background: rgba(0,219,222,0.1); padding: 15px; border-radius: 10px;">
                    <h4 style="color: #00ff7f;">ğŸ’¡ ç³»ç»Ÿå»ºè®®</h4>
                    <ul style="margin: 10px 0 0 20px;">
                        ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        document.getElementById('analysisContent').innerHTML = analysisHTML;
    }
    
    // ==================== æ¸²æŸ“æ–¹æ³•åŸºå›  ====================
    function renderGenes(result) {
        if (!result.data || result.data.length === 0) {
            document.getElementById('genesSection').innerHTML = `
                <div style="text-align: center; padding: 30px; color: #ff6b6b;">
                    <h4>âš ï¸ æœªæ‰¾åˆ°é«˜ç›¸å…³æ–¹æ³•åŸºå› </h4>
                    <p>å»ºè®®è°ƒæ•´æè¿°æˆ–æ¢ç´¢é€šç”¨æ–¹æ³•è®º</p>
                </div>
            `;
            return;
        }
        
        let genesHTML = `
            <div style="color: #00ff7f; margin-bottom: 15px;">
                âœ… ä¸ºæ‚¨ç²¾å‡†åŒ¹é… ${result.data.length} ä¸ªæ–¹æ³•åŸºå› 
            </div>
        `;
        
        result.data.forEach((gene, index) => {
            const isPrimary = index === 0;
            
            genesHTML += `
                <div class="gene-card" ${isPrimary ? 'style="border-left: 4px solid #fc00ff;"' : ''}>
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="margin: 0; color: ${isPrimary ? '#fc00ff' : '#00dbde'}">
                                ${isPrimary ? 'â­ ' : ''}${gene.title}
                            </h4>
                            <p style="opacity: 0.8; margin: 5px 0; font-size: 0.9rem;">
                                æ¥æº: ${gene.origin_domain} | å¤æ‚åº¦: ${'â˜…'.repeat(gene.complexity_level)}
                            </p>
                        </div>
                        <button class="arm-button" style="padding: 5px 15px; font-size: 0.8rem;" 
                                onclick="focusGene(${gene.id})">
                            æ·±åº¦åº”ç”¨
                        </button>
                    </div>
                    
                    <p style="margin: 15px 0; line-height: 1.6;">${gene.description}</p>
                    
                    <div style="margin: 10px 0;">
                        <strong style="color: #00dbde;">æ ‡ç­¾:</strong>
                        <div style="margin-top: 8px;">
                            ${gene.tags.map(tag => `<span class="gene-tag">#${tag}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; font-size: 0.9rem;">
                        <strong style="color: #00ff7f;">ğŸš€ å¯åº”ç”¨äº:</strong>
                        <p style="margin: 5px 0;">${gene.applicable_domains.join(' Â· ')}</p>
                    </div>
                    
                    ${gene.problem_scenarios ? `
                    <div style="margin-top: 15px; font-size: 0.85rem; opacity: 0.9;">
                        <strong>ğŸ’¡ è§£å†³åœºæ™¯:</strong>
                        <p style="margin: 5px 0;">${gene.problem_scenarios.join('ã€')}</p>
                    </div>
                    ` : ''}
                </div>
            `;
        });
        
        document.getElementById('genesSection').innerHTML = genesHTML;
    }
    
    // ==================== ç”Ÿæˆä¸‰å¤´å…­è‡‚æ–¹æ¡ˆ ====================
    function renderThreeHeadsSixArms(result) {
        const genes = result.data;
        const analysis = result.analysis;
        
        if (genes.length === 0) return;
        
        // æ–‡å­¦å¤´ - åŸºäºå™äº‹ç›¸å…³åŸºå› 
        const narrativeGenes = genes.filter(g => 
            g.tags.some(t => ['å™äº‹', 'ç»“æ„', 'åŸå‹', 'æ•…äº‹', 'æ‚¬å¿µ'].includes(t))
        );
        document.getElementById('literatureHead').innerHTML = narrativeGenes.length > 0 ?
            `åº”ç”¨<b>${narrativeGenes[0].title}</b>åŸºå› ï¼Œæ„å»º${analysis.matched_domains[0] || 'ä¸“ä¸š'}é¢†åŸŸçš„å™äº‹æ¡†æ¶ï¼Œé‡ç‚¹è§£å†³${analysis.matched_scenarios[0] || 'æ ¸å¿ƒé—®é¢˜'}` :
            `åŸºäºæ‚¨çš„${analysis.matched_domains[0] || 'ä¸“ä¸š'}èƒŒæ™¯ï¼Œè®¾è®¡åˆ›æ–°å™äº‹ç»“æ„`;
        
        // éŸ³ä¹å¤´ - åŸºäºèŠ‚å¥ç›¸å…³åŸºå› 
        const rhythmGenes = genes.filter(g => 
            g.tags.some(t => ['èŠ‚å¥', 'æƒ…ç»ª', 'å¯¹æ¯”', 'å¾ªç¯', 'ç»“æ„'].includes(t))
        );
        document.getElementById('musicHead').innerHTML = rhythmGenes.length > 0 ?
            `è¿ç”¨<b>${rhythmGenes[0].title}</b>åŸç†ï¼Œè§„åˆ’é¡¹ç›®èŠ‚å¥ä¸æƒ…ç»ªæ›²çº¿ï¼Œé€‚é…${genes[0].applicable_domains[0] || 'ç›®æ ‡'}é¢†åŸŸçš„ä¼ æ’­éœ€æ±‚` :
            `è®¾è®¡å…·æœ‰${analysis.matched_tags[0] || 'ç‹¬ç‰¹'}èŠ‚å¥çš„ä¸“ä¸šè¡¨è¾¾æ–¹æ¡ˆ`;
        
        // å½±è§†å¤´ - åŸºäºè§†è§‰ç›¸å…³åŸºå› 
        const visualGenes = genes.filter(g => 
            g.tags.some(t => ['è§†è§‰', 'ç©ºé—´', 'æ„è±¡', 'æ„å›¾', 'å¼•å¯¼'].includes(t))
        );
        document.getElementById('filmHead').innerHTML = visualGenes.length > 0 ?
            `é‡‡ç”¨<b>${visualGenes[0].title}</b>æ‰‹æ³•ï¼Œåˆ›å»º${genes.length}å¥—è§†è§‰è¡¨è¾¾æ–¹æ¡ˆï¼Œå¢å¼º${analysis.matched_domains[1] || 'ä¸“ä¸š'}å½±å“åŠ›` :
            `ç­–åˆ’è·¨åª’ä½“è§†è§‰å™äº‹ï¼Œæ”¾å¤§æ‚¨çš„${analysis.matched_domains[0] || 'æ ¸å¿ƒ'}ä»·å€¼`;
        
        // å…­è‡‚æ‰§è¡Œè¯¦æƒ…
        const armDetails = [
            `è¯Šæ–­: æ·±åº¦è§£æ„${genes.length}ä¸ªæ ¸å¿ƒæ–¹æ³•åŸºå› `,
            `å«æ¥: ç§»æ¤åˆ°${analysis.matched_domains.slice(0,3).join('ã€')}é¢†åŸŸ`,
            `æ¶æ„: ${genes.length * 4}å‘¨å®æ–½è·¯çº¿å›¾`,
            `ç‰©æ–™: ${genes.length * 3}å¥—ä¸“ä¸šæ¨¡æ¿`,
            `å˜ç°: ${genes.reduce((sum, g) => sum + g.complexity_level, 0) * 2}-${genes.reduce((sum, g) => sum + g.complexity_level, 0) * 5}ä¸‡æŠ¥ä»·åŒºé—´`,
            `ååŒ: ${genes.length * 2}ä¸ªèµ„æºæ¸ é“æ¨è`
        ];
        
        document.getElementById('executionDetails').innerHTML = `
            <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px;">
                <h4 style="color: #00dbde;">ğŸ“‹ è¯¦ç»†æ‰§è¡Œæ–¹æ¡ˆ</h4>
                <ul style="margin: 15px 0 0 20px; line-height: 1.8;">
                    ${armDetails.map(detail => `<li>${detail}</li>`).join('')}
                </ul>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="arm-button" onclick="exportPlan()">
                        ğŸ“¥ å¯¼å‡ºå®Œæ•´æ–¹æ¡ˆæ–‡æ¡£
                    </button>
                </div>
            </div>
        `;
    }
    
    // ==================== å…­è‡‚åŠŸèƒ½ ====================
    function armFunction(armType) {
        if (!currentGenes || currentGenes.length === 0) {
            alert('è¯·å…ˆç”Ÿæˆæ™ºèƒ½åˆ†ææ–¹æ¡ˆ');
            return;
        }
        
        const armTitles = {
            diagnose: 'è¯Šæ–­è‡‚ - èƒ½åŠ›æ·±åº¦è§£æ„',
            graft: 'å«æ¥è‡‚ - è·¨ç•Œèƒ½åŠ›ç§»æ¤',
            architect: 'æ¶æ„è‡‚ - å®æ–½æ–¹æ¡ˆè®¾è®¡',
            material: 'ç‰©æ–™è‡‚ - å·¥å…·æ¨¡æ¿ç”Ÿæˆ',
            monetize: 'å˜ç°è‡‚ - å•†ä¸šä»·å€¼å®ç°',
            collaborate: 'ååŒè‡‚ - èµ„æºç½‘ç»œè¿æ¥'
        };
        
        const primaryGene = currentGenes[0];
        
        alert(`å¯åŠ¨ã€${armTitles[armType]}ã€‘\n\nåŸºäºæ–¹æ³•åŸºå› : ${primaryGene.title}\n\nè¯¦ç»†åŠŸèƒ½å³å°†å¼€æ”¾ï¼Œä¸“ä¸šç‰ˆç”¨æˆ·å¯äº«å—å®Œæ•´å·¥ä½œæµã€‚`);
    }
    
    // ==================== å•†ä¸šåŒ–åŠŸèƒ½ ====================
    function showCommercialPanel() {
        document.getElementById('commercialPanel').style.display = 'block';
        document.getElementById('commercialPanel').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
    }
    
    function selectPlan(planType) {
        const plans = {
            trial: { name: 'ä½“éªŒç‰ˆ', price: 299, desc: 'å•æ¬¡æ·±åº¦åˆ†ææŠ¥å‘Š' },
            pro: { name: 'ä¸“ä¸šç‰ˆ', price: 999, desc: 'æœˆåº¦æ— é™ç”Ÿæˆ + å•†ä¸šå·¥å…·' },
            enterprise: { name: 'ä¼ä¸šç‰ˆ', price: 9999, desc: 'å¹´åº¦åˆä¼™äºº + å®šåˆ¶æœåŠ¡' }
        };
        
        const plan = plans[planType];
        
        document.getElementById('commercialOutput').innerHTML = `
            <div style="background: rgba(0,219,222,0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
                <h4>ğŸ‰ é€‰æ‹© ${plan.name}</h4>
                <p>ä»·æ ¼: <strong style="color: #fc00ff; font-size: 1.2rem;">Â¥${plan.price}</strong></p>
                <p>åŒ…å«: ${plan.desc}</p>
                <div style="margin-top: 20px;">
                    <button class="arm-button" onclick="simulatePayment('${planType}')">
                        ğŸ’³ æ¨¡æ‹Ÿæ”¯ä»˜ (æ¼”ç¤º)
                    </button>
                    <button class="arm-button" onclick="contactSales()" style="background: rgba(255,255,255,0.1);">
                        ğŸ“ è”ç³»å•†åŠ¡
                    </button>
                </div>
            </div>
        `;
    }
    
    function simulatePayment(planType) {
        alert(`ğŸ’° æ”¯ä»˜æµç¨‹æ¼”ç¤º\n\næ‚¨é€‰æ‹©äº† ${planType} å¥—é¤\n\nçœŸå®æ”¯ä»˜éœ€è¦é›†æˆ Stripe/æ”¯ä»˜å® API\n\nå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ï¼Œæ”¯ä»˜åŠŸèƒ½æš‚æœªæ¿€æ´»`);
    }
    
    function generateQuote() {
        if (!currentGenes || currentGenes.length === 0) {
            alert('è¯·å…ˆç”Ÿæˆæ™ºèƒ½åˆ†ææ–¹æ¡ˆ');
            return;
        }
        
        const totalComplexity = currentGenes.reduce((sum, g) => sum + g.complexity_level, 0);
        const basePrice = 5000 + (totalComplexity * 2000);
        
        const quoteHTML = `
            <div style="background: white; color: #333; padding: 25px; border-radius: 10px; margin-top: 20px;">
                <h3 style="color: #1a1a2e;">ğŸ“„ ä¸“ä¸šæœåŠ¡æŠ¥ä»·å•</h3>
                <div style="margin: 20px 0;">
                    <p><strong>é¡¹ç›®åç§°:</strong> ${currentAnalysis?.user_input || 'ä¸“ä¸šèƒ½åŠ›'} è·¨ç•Œèµ‹èƒ½æ–¹æ¡ˆ</p>
                    <p><strong>æŠ¥ä»·æ€»é¢:</strong> <span style="color: #fc00ff; font-size: 1.5rem;">Â¥${basePrice.toLocaleString()}</span></p>
                    <p><strong>æœåŠ¡å‘¨æœŸ:</strong> ${totalComplexity * 2} å‘¨</p>
                    <p><strong>æ ¸å¿ƒæ–¹æ³•æ”¯æ’‘:</strong></p>
                    <ul>
                        ${currentGenes.slice(0,3).map(gene => 
                            `<li>${gene.title} (${gene.origin_domain})</li>`
                        ).join('')}
                    </ul>
                    <p><strong>äº¤ä»˜ç‰©:</strong></p>
                    <ul>
                        <li>å®Œæ•´è·¨ç•Œæ–¹æ¡ˆæ–‡æ¡£</li>
                        <li>å®æ–½è·¯çº¿å›¾</li>
                        <li>å•†ä¸šææ¡ˆæ¨¡æ¿</li>
                        <li>ä¸“ä¸šæŒ‡å¯¼å’¨è¯¢</li>
                    </ul>
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="arm-button" onclick="downloadQuote()" 
                                style="background: #00dbde; color: white;">
                            ğŸ“¥ ä¸‹è½½æŠ¥ä»·å• (PDF)
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('commercialOutput').innerHTML = quoteHTML;
    }
    
    // ==================== è¾…åŠ©å‡½æ•° ====================
    function focusGene(geneId) {
        const gene = currentGenes.find(g => g.id === geneId);
        if (gene) {
            document.getElementById('analysisContent').scrollIntoView({ behavior: 'smooth' });
            
            document.getElementById('analysisContent').innerHTML += `
                <div style="background: rgba(252,0,255,0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="color: #fc00ff;">ğŸ¯ æ·±åº¦èšç„¦: ${gene.title}</h4>
                    <p><strong>åº”ç”¨å»ºè®®:</strong> å°†æ­¤åŸºå› æ–¹æ³•ç³»ç»ŸåŒ–åº”ç”¨äºæ‚¨çš„${currentAnalysis?.matched_domains[0] || 'ä¸“ä¸š'}å®è·µ</p>
                    <p><strong>å®æ–½æ­¥éª¤:</strong></p>
                    <ol style="margin: 10px 0 0 20px;">
                        <li>è§£æ„ ${gene.title} çš„æ ¸å¿ƒåŸç†</li>
                        <li>æ˜ å°„åˆ°æ‚¨ç°æœ‰çš„å·¥ä½œæµç¨‹</li>
                        <li>è®¾è®¡ ${gene.complexity_level * 2} å‘¨å®æ–½è®¡åˆ’</li>
                        <li>åˆ›å»ºæ•ˆæœè¯„ä¼°æŒ‡æ ‡</li>
                    </ol>
                </div>
            `;
        }
    }
    
    function generateLocalFallback(userInput) {
        // æœ¬åœ°é™çº§é€»è¾‘
        const fallbackGenes = [
            {
                title: "é€šç”¨åˆ›æ–°æ¡†æ¶",
                description: "é€‚ç”¨äºå¤šé¢†åŸŸçš„ç»“æ„åŒ–åˆ›æ–°æ–¹æ³•è®º",
                origin_domain: "ç³»ç»Ÿé€šç”¨",
                tags: ["åˆ›æ–°", "æ¡†æ¶", "æ–¹æ³•è®º"],
                applicable_domains: ["é€šç”¨é¢†åŸŸ"],
                complexity_level: 2
            }
        ];
        
        currentGenes = fallbackGenes;
        
        // ç®€å•æ¸²æŸ“
        document.getElementById('literatureHead').textContent = "åŸºäºæœ¬åœ°çŸ¥è¯†åº“ç”Ÿæˆå™äº‹å»ºè®®";
        document.getElementById('musicHead').textContent = "è®¾è®¡é€šç”¨èŠ‚å¥ä¸ç»“æ„æ–¹æ¡ˆ";
        document.getElementById('filmHead').textContent = "ç­–åˆ’åŸºç¡€è§†è§‰è¡¨è¾¾æ¡†æ¶";
        
        document.getElementById('executionDetails').innerHTML = `
            <div style="color: #ff6b6b;">
                <p>âš ï¸ å½“å‰ä¸ºæœ¬åœ°é™çº§æ¨¡å¼ï¼ŒåŠŸèƒ½å—é™</p>
                <p>å»ºè®®è¿æ¥åˆ°äº‘ç«¯æ™ºèƒ½å¼•æ“è·å¾—å®Œæ•´åŠŸèƒ½</p>
            </div>
        `;
    }
    
    function exportPlan() {
        alert('ğŸ“¤ æ–¹æ¡ˆå¯¼å‡ºåŠŸèƒ½\n\nä¸“ä¸šç‰ˆåŠŸèƒ½ï¼šå¯å¯¼å‡ºå®Œæ•´çš„PDFæ–¹æ¡ˆæ–‡æ¡£ï¼ŒåŒ…å«è¯¦ç»†å®æ–½æ­¥éª¤ã€æ¨¡æ¿å’Œèµ„æºæ¨èã€‚');
    }
    
    function createProposal() {
        alert('ğŸ“‹ ææ¡ˆç”ŸæˆåŠŸèƒ½\n\næ ¹æ®æ‚¨çš„åˆ†æç»“æœï¼Œè‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ææ¡ˆæ–‡æ¡£ã€‚');
    }
    
    function showContract() {
        alert('ğŸ“‘ åˆåŒæ¨¡æ¿\n\næä¾›æ ‡å‡†æœåŠ¡åˆåŒæ¨¡æ¿ï¼Œæ”¯æŒè‡ªå®šä¹‰æ¡æ¬¾ã€‚');
    }
    
    function calculateROI() {
        alert('ğŸ“Š ROIåˆ†æå™¨\n\nè®¡ç®—é¡¹ç›®æŠ•èµ„å›æŠ¥ç‡ï¼Œè¯„ä¼°å•†ä¸šä»·å€¼ã€‚');
    }
    
    function paymentOptions() {
        alert('ğŸ’³ æ”¯ä»˜è®¾ç½®\n\né…ç½®æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è¡Œå¡ç­‰æ”¯ä»˜æ–¹å¼ã€‚');
    }
    
    function contactSales() {
        alert('ğŸ“ å•†åŠ¡è”ç³»\n\nè”ç³»ç”µè¯: 400-xxx-xxxx\nå•†åŠ¡é‚®ç®±: business@threeheads.com');
    }
    
    function downloadQuote() {
        alert('ğŸ“¥ ä¸‹è½½åŠŸèƒ½\n\nPDFç”Ÿæˆéœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒï¼Œå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ã€‚');
    }
    
    // ==================== é¡µé¢åˆå§‹åŒ– ====================
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸš€ ä¸‰å¤´å…­è‡‚åˆ›ä¸–ç³»ç»Ÿ v2.0 å·²åŠ è½½');
        
        // æµ‹è¯•APIè¿æ¥
        setTimeout(() => {
            fetch('/.netlify/functions/searchGenes?query=æµ‹è¯•')
                .then(() => {
                    document.getElementById('apiStatus').innerHTML = 
                        'äº‘ç«¯æ™ºèƒ½å¼•æ“ âœ“ åœ¨çº¿';
                    document.getElementById('apiStatus').style.color = '#00ff7f';
                })
                .catch(() => {
                    document.getElementById('apiStatus').innerHTML = 
                        'æ™ºèƒ½å¼•æ“ âœ— ç¦»çº¿ | éƒ¨åˆ†åŠŸèƒ½å—é™';
                    document.getElementById('apiStatus').style.color = '#ff6b6b';
                });
        }, 1000);
    });
    </script>
</body>
</html>
